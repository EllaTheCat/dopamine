#!/bin/bash
#
# Display off/on.
#
# Requires i3-mouse for setmouse, xdotool.
#

#
# My three monitors were arranged thus: [HDMI2] [HDMI1] [VGA1].
# Use 'xrandr' with no arguments to list monitor names and geometry.
#
lmon=HDMI2
cmon=HDMI1
rmon=VGA

setdisplay ()
{
    # Initialise the "monitor dmenu" to be on monitor number zero.
    [ ! -e  "/dev/shm/$USER/mflag" ] && "echo 0 > /dev/shm/$USER/mflag"
    case "$1" in
        # Sleep the display using the keyboard or console, not the
        # mouse.
        (sleep|off)
        xdotool mousemove --clearmodifiers 2048 128
        i3-mouse disable
        sleep 3s
        xset s blank
        xset dpms 0 0 0
        xset dpms force off
        ;;
        # Wake the display using the keyboard or console, not the
        # mouse.
        (wake|on)
        i3-mouse enable
        xdotool mousemove --clearmodifiers 2048 128
        xset s off
        xset -dpms
        ;;
        # Turn monitors on and off.
        (menu)
        mflag=$(cat "/dev/shm/$USER/mflag")
        list="left on\nleft off\nmiddle on\nmiddle off\nright on\nright off"
        item=$(echo -e "cancel\n${list}" | dmenu -b -fn 'pango:DejaVu Sans 11' -m "${mflag}" -p 'Monitors: ')
        [ "${item}" != "cancel" ] && eval "$0 ${item/ /}"  # "a b" => "ab"
        ;;
        (lefton)
        echo 0 > "/dev/shm/$USER/mflag"
        xrandr --output "${lmon}" --auto --left-of "${cmon}"
        xrandr --output "${lmon}" --brightness 1.0
        ;;
        (leftoff)
        echo 0 > "/dev/shm/$USER/mflag"
        xrandr --output "${lmon}" --off
        ;;
        (middleon)
        echo 0 > "/dev/shm/$USER/mflag"
        xrandr --output "${cmon}" --auto --rightof "${lmon}"
        xrandr --output "${cmon}" --brightness 1.0
        ;;
        (middleoff)
        echo 1 > "/dev/shm/$USER/mflag"  # Move the dmenu!
        xrandr --output "${cmon}" --off
        ;;
        (righton)
        echo 0 > "/dev/shm/$USER/mflag"
        xrandr --output "${rmon}" --auto --right-of "${cmon}"
        xrandr --output "${rmon}" --brightness 1.0
        ;;
        (rightoff)
        echo 0 > "/dev/shm/$USER/mflag"
        xrandr --output "${rmon}" --off
        ;;
    esac
}

setdisplay "$1"

#
# Done.
#
