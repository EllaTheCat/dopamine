#!/bin/bash
#
# Scripted playback of keyboard and mouse input specific to my
# Xubuntu DE with i3 WM, "dopamine" by EllaTheCat on github.
#
# -  2020-04-15: My understanding of xdotool has been proven to be
#    inadequate. It's important to understand what is wrong and why.
#

#
# Bash script.
#
cat $0 | while read line; do
    case ${line} in
        (:cmd*)
        string=${line/:cmd /}
        dash -c "xdotool key --clearmodifiers Menu"
        sleep 0.2
        dash -c "xdotool key --clearmodifiers backslash"
        sleep 1
        if [ "${string}" = "timeout" ]; then
            dash -c "xdotool key --clearmodifiers Right"
            sleep 10
            dash -c "xdotool key --clearmodifiers Escape"
        else
            dash -c "xdotool type --clearmodifiers ${string}"
            sleep 5
        fi
        ;;
        (:str*)
        string=${line/:str /}
        dash -c "xdotool type --clearmodifiers  ${string}"
        sleep 0.2
        ;;
        (:def*)
        string=${line/:def /}
        dash -c "xdotool type --clearmodifiers ${string}"
        sleep 0.2
        ;;
        (:pri*)
        string=${line/:pri /}
        dash -c "xdotool key --clearmodifiers Menu"
        sleep 0.2
        dash -c "xdotool type --clearmodifiers ${string}"
        sleep 0.2
        ;;
        (:sec*)
        string=${line/:sec /}
        dash -c "xdotool key --clearmodifiers Menu"
        sleep 0.2
        dash -c "xdotool key --clearmodifiers Menu"
        sleep 0.2
        dash -c "xdotool type --clearmodifiers ${string}"
        ;;

        (:mouse*)
        button=$(echo $line | awk '{print $2}')
        x=$(echo $line | awk '{print $3}')
        y=$(echo $line | awk '{print $4}')
        xdotool  getactivewindow mousemove --sync $x $y
        case ${button} in
            (1|2|3|4|5) xdotool getactivewindow click --clearmodifiers ${button} ;;
        esac
        sleep 0.2
        ;;
        (:yad*)
        x=$(echo $line | awk '{print $2}')
        y=$(echo $line | awk '{print $3}')
        t=$(echo $line | awk '{print $4}')
        message=${line/:yad $x $y $t /}
        xdotool mousemove --sync $x $y
        2>&1  yad --width 200 --mouse --no-buttons \
              --timeout=${t} --timeout-indicator=bottom \
              --title=Comment --text="${message}" | \
            grep -v 'Gtk-Message: GtkDialog mapped without a transient parent. This is discouraged.'
        sleep 0.2
        ;;
        (:sleep*)
        sleep ${line/:sleep /}
        ;;
        (:quit)
        exit 0
        ;;
    esac
done
exit 0

#
# Custom scripts
#

:yad 2112 600 7 "Menu | Tab or Menu | backslash presents a dmenu at the bottom of the screen that expects a two or three character command. The timeout is expected to expire after four seconds, at which time the command is dispatched. Users can type Return for faster dispatch. Hovering over Cancel dismisses. Hovering over Help presents a sideways scrolling dmenu showing a subset of some two character commands automatically extracted from the source."
:cmd timeout
:quit
:cmd g7
:mouse 1 2190 61
:quit

#
# Done.
#
